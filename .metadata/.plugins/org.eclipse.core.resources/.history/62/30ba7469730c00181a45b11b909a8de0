import java.util.HashMap;
import java.util.Map;

public class Solution4<K, V> {
	  //1. quick find, hashmap
	  //2. quick insert, linkedlist
	  //3. quick delete, doublely linkedlist.
	  //4. move recently used at the beginning, doublely linkedlist.
	  class dLinkedList{
	    dLinkedList prev;
	    dLinkedList next;
	    V value;
	    public dLinkedList(V value) {
	      this.value = value;
	    }
	  }
	  dLinkedList head;
	  dLinkedList tail;
	  Map<K,V> searchMap;
	  int cap;
	  // limit is the max capacity of the cache
	  public Solution4(int limit) {
	  	cap = limit;
	    searchMap = new HashMap<K,dLinkedList>();
	    head = null;
	    tail = null;
	  }
	  
	  public void set(K key, V value) {
	  	dLinkedList target = map.get(K);
	    if (target == null) {
	      addDLL(new dLinkedList(value));
	      map.put(K, head);
	    } else {
	      target.value = value;
	      updateHead(target);
	    }
	    if (map.size() > limit) {
	      deleteTail();
	    }
	  }
	  
	  public V get(K key) {
	    dLinkedList target = map.get(K);
	    if (target == null) {
	      return null;
	    } else {
	      return target.value;
	    }
	  }
	  
	  private void addDLL(dLinkedList dll) {
	      if (head == null) {
	      head = dll;
	      tail = dll;
	      } else {
	        dll.next = head;
	      	head.pre = dll;
	        head = dll;
	      }
	  }
	  
	  private void updateHead(dLinkedList dll) {
	    if (head == null) {
	      head = dll;
	      tail = dll;
	    } else {
	      dll.prev.next = dll.next;
	      dll.next.prev = dll.prev;
	      dll.prev = null;
	      dll.next = head;
	      head.pre = dll;
	      head = dll;
	    }
	  }
	  
	  private void deleteTail() {
	    if (tail == null) {
	      return;
	    }
	    if (tail == head) {
	      tail == null;
	      head == null;
	    }
	    dLinkedList prev = tail.prev;
	    tail.prev.next = null;
	    tail.prev = null;
	    tail = prev;
	  }
}
